---
layout: none
permalink: /search.json
---

{%- comment -%} 
Collect all pages from pages, posts, and other collections
{%- endcomment -%}

{%- assign all_pages = site.pages | concat: site.posts -%}
{%- for coll in site.collections -%}
  {%- unless coll.label == "posts" -%}
    {%- assign all_pages = all_pages | concat: coll.docs -%}
  {%- endunless -%}
{%- endfor -%}

{%- comment -%} Collect all tags from all pages {%- endcomment -%}
{%- assign all_tags = "" | split: "" -%}
{%- for page in all_pages -%}
  {%- if page.tags -%}
    {%- for tag in page.tags -%}
      {%- assign tag_down = tag | downcase -%}
      {%- unless all_tags contains tag_down -%}
        {%- assign all_tags = all_tags | push: tag_down -%}
      {%- endunless -%}
    {%- endfor -%}
  {%- endif -%}
{%- endfor -%}

{%- assign all_tags = all_tags | sort -%}

{%- comment -%} Output JSON {%- endcomment -%}
{
{%- assign first_tag = true -%}
{%- for tag in all_tags -%}
  {%- if first_tag -%}
    {%- assign first_tag = false -%}
  {%- else -%}
    ,
  {%- endif -%}

  "{{ tag }}": [
    {%- assign first_page = true -%}
    {%- for page in all_pages -%}
      {%- if page.tags contains tag -%}
        {%- assign title = page.title | jsonify -%}
        {%- assign url   = page.url | relative_url | jsonify -%}
        {%- assign date  = page.date | date_to_xmlschema | jsonify -%}

        {%- if first_page -%}
          {%- assign first_page = false -%}
        {%- else -%}
          ,
        {%- endif -%}

        { "title": {{ title }}, "url": {{ url }}, "date": {{ date }} }
      {%- endif -%}
    {%- endfor -%}
  ]
{%- endfor -%}
}
